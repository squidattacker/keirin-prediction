{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.1", "generated_at": "2025-11-12T14:48:39.701910Z", "invocation_id": "0588d60c-8e39-4783-b39f-5a149a4e7c2d", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-12T14:48:35.503424Z", "completed_at": "2025-11-12T14:48:35.520804Z"}, {"name": "execute", "started_at": "2025-11-12T14:48:35.522524Z", "completed_at": "2025-11-12T14:48:35.892815Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.3925199508666992, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.winticket_dbt.bronze_race_results", "compiled": true, "compiled_code": "\n\nselect\n  meta['raceId']::varchar as race_id,\n  meta['cupId']::varchar as cup_id,\n  meta['raceNumber']::int as race_number,\n  meta['index']::int as day_index,\n  meta['venueSlug']::varchar as venue_slug,\n  meta['capturedAt']::varchar as captured_at,\n  meta,\n  state\nfrom read_json_auto('/workspace/app/data/winticket_lake/bronze/results/*.json')", "relation_name": "\"winticket\".\"main_bronze\".\"bronze_race_results\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-12T14:48:35.514722Z", "completed_at": "2025-11-12T14:48:35.536268Z"}, {"name": "execute", "started_at": "2025-11-12T14:48:35.552637Z", "completed_at": "2025-11-12T14:48:35.904266Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.4384329319000244, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.winticket_dbt.bronze_racecards", "compiled": true, "compiled_code": "\n\nselect\n  meta['raceId']::varchar as race_id,\n  meta['cupId']::varchar as cup_id,\n  meta['raceNumber']::int as race_number,\n  meta['index']::int as day_index,\n  meta['venueSlug']::varchar as venue_slug,\n  meta['capturedAt']::varchar as captured_at,\n  meta,\n  state\nfrom read_json_auto('/workspace/app/data/winticket_lake/bronze/racecards/*.json')", "relation_name": "\"winticket\".\"main_bronze\".\"bronze_racecards\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-12T14:48:35.906687Z", "completed_at": "2025-11-12T14:48:35.914032Z"}, {"name": "execute", "started_at": "2025-11-12T14:48:35.914593Z", "completed_at": "2025-11-12T14:48:36.279954Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.3756844997406006, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.winticket_dbt.silver_race_results", "compiled": true, "compiled_code": "\n\nwith rr as (\n    select\n        race_id,\n        state['race_common']['results'] as results\n    from \"winticket\".\"main_bronze\".\"bronze_race_results\"\n)\nselect\n    race_id,\n    result['playerId']::varchar as player_id,\n    result['order']::int as finish_order,\n    result['factor']::varchar as finish_factor,\n    result['finalHalfRecord']::varchar as final_half_record\nfrom rr\ncross join unnest(results) as r(result)", "relation_name": "\"winticket\".\"main_silver\".\"silver_race_results\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-12T14:48:35.965193Z", "completed_at": "2025-11-12T14:48:35.987929Z"}, {"name": "execute", "started_at": "2025-11-12T14:48:36.036607Z", "completed_at": "2025-11-12T14:48:36.427464Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.4711151123046875, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.winticket_dbt.silver_race_entries", "compiled": true, "compiled_code": "\n\nwith rc as (\n    select\n        race_id,\n        cup_id,\n        race_number,\n        day_index,\n        venue_slug,\n        state['race_common']['entries'] as entries,\n        state['race_common']['records'] as records,\n        state['race_common']['players'] as players\n    from \"winticket\".\"main_bronze\".\"bronze_racecards\"\n),\nentries as (\n    select\n        race_id,\n        entry['playerId']::varchar as player_id,\n        entry['number']::int as number,\n        entry['bracketNumber']::int as bracket_number,\n        entry['absent']::boolean as is_absent,\n        entry\n    from rc\n    cross join unnest(entries) as e(entry)\n),\nrecords as (\n    select\n        race_id,\n        rec['playerId']::varchar as player_id,\n        rec\n    from rc\n    cross join unnest(records) as r(rec)\n),\nplayers as (\n    select\n        race_id,\n        pl['id']::varchar as player_id,\n        pl\n    from rc\n    cross join unnest(players) as p(pl)\n),\nrecent_form as (\n    select\n        race_id,\n        rec['playerId']::varchar as player_id,\n        count(*)::int as recent_races,\n        avg(rr['order']::double)::double as recent_avg_order,\n        avg(case when rr['order'] = 1 then 1 else 0 end)::double as recent_win_rate,\n        avg(case when rr['order'] <= 3 then 1 else 0 end)::double as recent_top3_rate\n    from rc\n    cross join unnest(records) as r(rec)\n    cross join unnest(r.rec['latestCupResults']) as cup(cup_struct)\n    cross join unnest(cup.cup_struct['raceResults']) as rr(rr)\n    group by 1,2\n),\nvenue_form as (\n    select\n        race_id,\n        rec['playerId']::varchar as player_id,\n        count(*)::int as venue_races,\n        avg(rr['order']::double)::double as venue_avg_order,\n        avg(case when rr['order'] = 1 then 1 else 0 end)::double as venue_win_rate,\n        avg(case when rr['order'] <= 3 then 1 else 0 end)::double as venue_top3_rate\n    from rc\n    cross join unnest(records) as r(rec)\n    cross join unnest(r.rec['latestVenueResults']) as cup(cup_struct)\n    cross join unnest(cup.cup_struct['raceResults']) as rr(rr)\n    group by 1,2\n)\nselect\n    e.race_id,\n    rc.cup_id,\n    rc.race_number,\n    rc.day_index,\n    rc.venue_slug,\n    e.player_id,\n    e.number,\n    e.bracket_number,\n    e.is_absent,\n    r.rec['racePoint']::double as race_point,\n    r.rec['firstRate']::double as first_rate,\n    r.rec['secondRate']::double as second_rate,\n    r.rec['thirdRate']::double as third_rate,\n    r.rec['gearRatio']::double as gear_ratio,\n    r.rec['predictionMark']::int as prediction_mark,\n    r.rec['comment']::varchar as prediction_comment,\n    r.rec['style']::varchar as running_style,\n    r.rec['exSpurt']['percentage']::double as ex_spurt_pct,\n    r.rec['exThrust']['percentage']::double as ex_thrust_pct,\n    r.rec['exSplitLine']['percentage']::double as ex_split_pct,\n    r.rec['exCompete']['percentage']::double as ex_compete_pct,\n    r.rec['exLeftBehind']['percentage']::double as ex_leftbehind_pct,\n    r.rec['linePositionFirst']['firstPercentage']::double as line_first_pct,\n    r.rec['lineSingleHorseman']['firstPercentage']::double as line_single_pct,\n    p.pl['name']::varchar as player_name,\n    p.pl['prefecture']::varchar as prefecture,\n    p.pl['age']::int as age,\n    p.pl['class']::int as player_class,\n    p.pl['group']::int as player_group,\n    p.pl['regionId']::varchar as region_id,\n    coalesce(f.recent_races, 0) as recent_races,\n    coalesce(f.recent_avg_order, 0) as recent_avg_order,\n    coalesce(f.recent_win_rate, 0) as recent_win_rate,\n    coalesce(f.recent_top3_rate, 0) as recent_top3_rate,\n    coalesce(v.venue_races, 0) as venue_races,\n    coalesce(v.venue_avg_order, 0) as venue_avg_order,\n    coalesce(v.venue_win_rate, 0) as venue_win_rate,\n    coalesce(v.venue_top3_rate, 0) as venue_top3_rate\nfrom entries e\njoin rc on e.race_id = rc.race_id\nleft join records r on e.race_id = r.race_id and e.player_id = r.player_id\nleft join players p on e.race_id = p.race_id and e.player_id = p.player_id\nleft join recent_form f on e.race_id = f.race_id and e.player_id = f.player_id\nleft join venue_form v on e.race_id = v.race_id and e.player_id = v.player_id", "relation_name": "\"winticket\".\"main_silver\".\"silver_race_entries\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-12T14:48:35.983758Z", "completed_at": "2025-11-12T14:48:36.035769Z"}, {"name": "execute", "started_at": "2025-11-12T14:48:36.041684Z", "completed_at": "2025-11-12T14:48:36.435388Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.47467923164367676, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.winticket_dbt.silver_race_metadata", "compiled": true, "compiled_code": "\n\nwith rc as (\n    select\n        race_id,\n        cup_id,\n        race_number,\n        day_index,\n        venue_slug,\n        state['race_common']['race'] as race_struct,\n        state['race_common']['schedule'] as schedule_struct\n    from \"winticket\".\"main_bronze\".\"bronze_racecards\"\n)\nselect\n    race_id,\n    cup_id,\n    race_number,\n    day_index,\n    venue_slug,\n    schedule_struct['date']::varchar as schedule_date,\n    schedule_struct['day']::int as schedule_day,\n    race_struct['distance']::int as distance_m,\n    race_struct['class']::varchar as race_class,\n    race_struct['raceType3']::varchar as race_phase,\n    race_struct['weather']::varchar as weather,\n    race_struct['windSpeed']::varchar as wind_speed,\n    race_struct['entriesNumber']::int as entries_number,\n    race_struct['startAt']::bigint as start_at_epoch,\n    race_struct['closeAt']::bigint as close_at_epoch\nfrom rc", "relation_name": "\"winticket\".\"main_silver\".\"silver_race_metadata\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-12T14:48:35.975694Z", "completed_at": "2025-11-12T14:48:35.983171Z"}, {"name": "execute", "started_at": "2025-11-12T14:48:35.988501Z", "completed_at": "2025-11-12T14:48:36.438109Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.48134732246398926, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.winticket_dbt.silver_exacta_odds", "compiled": true, "compiled_code": "\n\nwith odds as (\n    select\n        race_id,\n        odds_struct\n    from \"winticket\".\"main_bronze\".\"bronze_racecards\"\n    cross join unnest(state['race_odds']['exacta']) as o(odds_struct)\n),\nprep as (\n    select\n        race_id,\n        odds_struct['key'][1]::int as first_number,\n        odds_struct['key'][2]::int as second_number,\n        odds_struct['odds']::double as odds,\n        odds_struct['popularityOrder']::double as popularity_order\n    from odds\n    where coalesce(odds_struct['absent']::boolean, false) = false\n)\nselect\n    race_id,\n    first_number,\n    min(odds) as min_exacta_odds_first,\n    max(odds) as max_exacta_odds_first,\n    avg(odds) as avg_exacta_odds_first,\n    max(odds) - min(odds) as spread_exacta_odds_first,\n    min(popularity_order) as min_exacta_popularity_first,\n    avg(popularity_order) as avg_exacta_popularity_first\nfrom prep\ngroup by 1,2", "relation_name": "\"winticket\".\"main_silver\".\"silver_exacta_odds\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-12T14:48:36.294005Z", "completed_at": "2025-11-12T14:48:36.310792Z"}, {"name": "execute", "started_at": "2025-11-12T14:48:36.314190Z", "completed_at": "2025-11-12T14:48:36.515412Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.2235114574432373, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.winticket_dbt.silver_tipster_predictions", "compiled": true, "compiled_code": "\n\nwith rc as (\n    select\n        race_id,\n        state['race_common']['predictions'] as predictions\n    from \"winticket\".\"main_bronze\".\"bronze_racecards\"\n),\nfiltered as (\n    select\n        race_id,\n        pred\n    from rc\n    cross join unnest(predictions) as p(pred)\n    where pred['tipsterId']::varchar = 'dsc-00'\n)\nselect\n    race_id,\n    pred['tipsterId']::varchar as tipster_id,\n    pred['name']::varchar as tipster_name,\n    idx.generate_series::int as pick_rank,\n    list_extract(pred['order'], idx.generate_series)::int as number\nfrom filtered\ncross join generate_series(1, array_length(pred['order'])) as idx(generate_series)", "relation_name": "\"winticket\".\"main_silver\".\"silver_tipster_predictions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-12T14:48:36.451680Z", "completed_at": "2025-11-12T14:48:36.456384Z"}, {"name": "execute", "started_at": "2025-11-12T14:48:36.457022Z", "completed_at": "2025-11-12T14:48:36.655611Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.2355175018310547, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.winticket_dbt.silver_head_to_head", "compiled": true, "compiled_code": "\n\nwith rc as (\n    select\n        race_id,\n        state['race_common']['competitionRecords'] as competition_records\n    from \"winticket\".\"main_bronze\".\"bronze_racecards\"\n),\nflat as (\n    select\n        race_id,\n        comp['playerId']::varchar as player_id,\n        comp['opponentId']::varchar as opponent_id,\n        coalesce(comp['wins']::int, 0) as wins,\n        coalesce(comp['losses']::int, 0) as losses\n    from rc\n    cross join unnest(competition_records) as c(comp)\n),\nfield_entries as (\n    select distinct race_id, player_id\n    from \"winticket\".\"main_silver\".\"silver_race_entries\"\n)\nselect\n    f.race_id,\n    f.player_id,\n    sum(f.wins) filter (where fe.player_id is not null) as field_head_to_head_wins,\n    sum(f.losses) filter (where fe.player_id is not null) as field_head_to_head_losses,\n    sum(f.wins + f.losses) filter (where fe.player_id is not null) as field_head_to_head_races\nfrom flat f\nleft join field_entries fe\n    on f.race_id = fe.race_id\n   and f.opponent_id = fe.player_id\ngroup by 1,2", "relation_name": "\"winticket\".\"main_silver\".\"silver_head_to_head\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-12T14:48:36.686666Z", "completed_at": "2025-11-12T14:48:36.694015Z"}, {"name": "execute", "started_at": "2025-11-12T14:48:36.694588Z", "completed_at": "2025-11-12T14:48:39.506072Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 2.919454336166382, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.winticket_dbt.gold_entry_features", "compiled": true, "compiled_code": "\n\nwith base as (\n    select\n        e.*,\n        m.schedule_date,\n        m.schedule_day,\n        m.distance_m,\n        m.weather,\n        m.wind_speed,\n        m.entries_number,\n        m.race_class,\n        m.race_phase\n    from \"winticket\".\"main_silver\".\"silver_race_entries\" e\n    left join \"winticket\".\"main_silver\".\"silver_race_metadata\" m using (race_id)\n),\nodds as (\n    select\n        race_id,\n        first_number,\n        min_exacta_odds_first,\n        max_exacta_odds_first,\n        avg_exacta_odds_first,\n        spread_exacta_odds_first,\n        min_exacta_popularity_first,\n        avg_exacta_popularity_first\n    from \"winticket\".\"main_silver\".\"silver_exacta_odds\"\n),\nh2h as (\n    select\n        race_id,\n        player_id,\n        coalesce(field_head_to_head_wins, 0) as field_head_to_head_wins,\n        coalesce(field_head_to_head_losses, 0) as field_head_to_head_losses,\n        coalesce(field_head_to_head_races, 0) as field_head_to_head_races\n    from \"winticket\".\"main_silver\".\"silver_head_to_head\"\n),\npicks as (\n    select\n        race_id,\n        number,\n        tipster_id,\n        tipster_name,\n        pick_rank\n    from \"winticket\".\"main_silver\".\"silver_tipster_predictions\"\n),\nresults as (\n    select * from \"winticket\".\"main_silver\".\"silver_race_results\"\n)\nselect\n    b.race_id,\n    b.cup_id,\n    b.race_number,\n    b.day_index,\n    b.venue_slug,\n    b.player_id,\n    b.player_name,\n    b.number,\n    b.bracket_number,\n    b.is_absent,\n    b.schedule_date,\n    b.schedule_day,\n    b.distance_m,\n    b.weather,\n    b.wind_speed,\n    b.entries_number,\n    b.race_class,\n    b.race_phase,\n    b.age,\n    b.player_class,\n    b.player_group,\n    b.region_id,\n    b.recent_races,\n    b.recent_avg_order,\n    b.recent_win_rate,\n    b.recent_top3_rate,\n    b.venue_races,\n    b.venue_avg_order,\n    b.venue_win_rate,\n    b.venue_top3_rate,\n    coalesce(b.race_point, 0) as racePoint,\n    coalesce(b.first_rate, 0) as firstRate,\n    coalesce(b.second_rate, 0) as secondRate,\n    coalesce(b.third_rate, 0) as thirdRate,\n    coalesce(b.ex_spurt_pct, 0) as exSpurt,\n    coalesce(b.ex_thrust_pct, 0) as exThrust,\n    coalesce(b.ex_split_pct, 0) as exSplit,\n    coalesce(b.ex_compete_pct, 0) as exCompete,\n    coalesce(b.ex_leftbehind_pct, 0) as exLeftBehind,\n    coalesce(b.line_first_pct, 0) as lineFirstPct,\n    coalesce(b.line_single_pct, 0) as lineSinglePct,\n    coalesce(o.min_exacta_odds_first, 0) as min_exacta_odds_first,\n    coalesce(o.max_exacta_odds_first, 0) as max_exacta_odds_first,\n    coalesce(o.avg_exacta_odds_first, 0) as avg_exacta_odds_first,\n    coalesce(o.spread_exacta_odds_first, 0) as spread_exacta_odds_first,\n    coalesce(o.min_exacta_popularity_first, 0) as min_exacta_popularity_first,\n    coalesce(o.avg_exacta_popularity_first, 0) as avg_exacta_popularity_first,\n    h.field_head_to_head_wins,\n    h.field_head_to_head_losses,\n    h.field_head_to_head_races,\n    coalesce(p.tipster_id, 'dsc-00') as tipster_id,\n    coalesce(p.tipster_name, 'N/A') as tipster_name,\n    p.pick_rank,\n    r.finish_order,\n    case\n        when r.finish_order = 1 then 1\n        when r.finish_order is null then null\n        else 0\n    end as is_winner\nfrom base b\nleft join odds o on b.race_id = o.race_id and b.number = o.first_number\nleft join h2h h on b.race_id = h.race_id and b.player_id = h.player_id\nleft join picks p on b.race_id = p.race_id and b.number = p.number\nleft join results r on b.race_id = r.race_id and b.player_id = r.player_id", "relation_name": "\"winticket\".\"main_gold\".\"gold_entry_features\"", "batch_results": null}], "elapsed_time": 5.835009813308716, "args": {"log_level": "info", "empty": false, "invocation_command": "dbt run", "require_nested_cumulative_type_params": false, "select": [], "cache_selected_only": false, "require_resource_names_without_spaces": false, "vars": {}, "populate_cache": true, "use_colors_file": true, "log_file_max_bytes": 10485760, "indirect_selection": "eager", "write_json": true, "macro_debugging": false, "partial_parse_file_diff": true, "quiet": false, "skip_nodes_if_on_run_start_fails": false, "log_path": "/workspace/app/winticket_dbt/logs", "print": true, "require_explicit_package_overrides_for_builtin_materializations": true, "project_dir": "/workspace/app/winticket_dbt", "log_format": "default", "send_anonymous_usage_stats": true, "log_format_file": "debug", "static_parser": true, "version_check": true, "state_modified_compare_vars": false, "partial_parse": true, "which": "run", "favor_state": false, "strict_mode": false, "source_freshness_run_project_hooks": false, "introspect": true, "log_level_file": "debug", "require_yaml_configuration_for_mf_time_spines": false, "defer": false, "show_resource_report": false, "use_colors": true, "warn_error_options": {"include": [], "exclude": []}, "exclude": [], "require_batched_execution_for_custom_microbatch_strategy": false, "state_modified_compare_more_unrendered_values": false, "printer_width": 80, "profiles_dir": "/workspace/app/winticket_dbt/profiles"}}